FROM centos:7

WORKDIR /build
COPY . .

ENV CC_TEST_REPORTER_ID @@CC_TEST_REPORTER_ID@@

RUN yum -y update

# The options are to install faster.
RUN yum -y install \
  --setopt=deltarpm=0 \
  --setopt=install_weak_deps=false \
  --setopt=tsflags=nodocs \
  git \
  gcc \
  make \
  centos-release-scl

RUN yum -y install \
  --setopt=deltarpm=0 \
  --setopt=install_weak_deps=false \
  --setopt=tsflags=nodocs \
  rh-ruby23 \
  rh-ruby23-ruby-devel \
  rh-ruby23-rubygems

RUN rpm -i @@AAL2_RPM@@

CMD sh .travis_run_build.sh
